<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;

class CourseSearchController extends Controller
{
    //
    function __construct () {
        parent::__construct();
        $this->general->title = 'course search';
    }
    function index(Request $request) {
        if (Auth::check()) {
            $this->general->identity = Auth::user()->getType();
            
            $lists = &$this->general->lists;
            $lists = DB::table('courses');
            $lists = $lists->join('course_professors', 'course_professors.course_id', '=', 'courses.id')->selectRaw('courses.name as course_name');
            $lists = $lists->join('users', 'users.id', '=', 'course_professors.professor_id')->selectRaw('users.name as professor_name');
            $lists = $lists->join('units', 'units.name', '=', 'courses.unit_name')->selectRaw('units.name as unit_name');

            $lists = $lists->crossjoin('course_time', 'course_time.course_id', '=', 'courses.id')->selectRaw('course_time.day_name as day_name, course_time.period_name as period_name');
            $temp = DB::table('course_time')->get();

            //var_dump(json_decode(json_encode($lists)));

            $lists = $lists->get();

            $this->general->units = DB::table('units')->get();

            $courseName = $request->input('courseName');
            return view('course_search', ['general' => $this->general]);
        }
        return redirect('sign_in');
    }
}
